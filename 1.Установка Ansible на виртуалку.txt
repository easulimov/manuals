Обновляем систему:
dnf update

Проверяем версию python3:
python3 --version

Обновить pip:
python3 -m pip install --upgrade pip

Обновить все пакеты:
#--no-cache-dir - добавить ключ, чтобы не использовать кэш
pip3 install -U $(pip3 freeze | cut -d '=' -f 1) 

Установка Ansible:
python3 -m pip install ansible

Проверка версии:
ansible --version

Создадим конфигурационный файл ansible.cfg:

vim ansible.cfg
######################################################################################
[defaults]

#указываем расположение файла inventory
inventory = /root/ansible/hosts  

#при подключении к клиентам не будет проверяться рукопожатие 
host_key_checking = false 

######################################################################################


Отредактируем файл inventory file /root/ansible/hosts:

vim /root/ansible/hosts
######################################################################################
[main]
client01 ansible_host=192.168.8.11 ansible_user=root ansible_password=123

[test]
client02 ansible_host=192.168.8.12 ansible_user=root ansible_ssh_private_key_file=/root/.ssh/id_rsa

[all_servers:children]
main
test

######################################################################################
***доступ по паролю не будет работать, без программы sshpass
dnf install sshpass

Проверим соединение с клиентами:
ansible all -m ping
ansible main -m ping
ansible test -m ping

Простые команды:

#Получить информацию о всех клиентах
ansible all -i hosts -m setup

#Выполнить shell команду на всех клиентах
ansible all -i hosts -m shell -a "uptime"

***shell запускается без проверки, например был создан ранее файл или нет, все равно будет записан новый/перезаписан.
Также имеются модули raw и command.
raw отличается от command и shell тем, что не выполняет дополнительную обработку выполнения команды. Эти дополнительные обработки присутствуют в почти любом модуле Ansible. Модуль raw передает команду, как есть в "сыром" виде без проверок.
Модули command и shell отличаются тем, что в модуле command команда выполняется без прохождения через оболочку /bin/sh. Поэтому переменные определенные в оболочке и перенаправления-конвееры работать не будут. Модуль shell выполняет команды через оболочку по умолчанию /bin/sh. Поэтому там будут доступны переменные оболочки и перенаправления.

#Создать файл на всех клиентах
ansible all -i hosts -m file -a "path=/root/ansible_test.txt state=touch"

#Скопировать файл на все клиенты группы test
ansible test -i hosts -m copy -a "src=/root/ansible_test.txt dest=/tmp mode=777" -b

*** -b - become
Ключевое слово become использует существующие инструменты повышения привилегий, такие как sudo, su, pfexec, doas, pbrun, dzdo, ksu, runas, machinectl и другие.







